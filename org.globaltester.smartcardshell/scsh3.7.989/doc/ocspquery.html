<!-- #BeginTemplate "template.dwt" -->
        <!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<!-- #BeginEditable "TITLE" -->
                <title>OCSPQuery - Reference Documentation</title>
                    <!-- #EndEditable -->
<link rel=stylesheet type="text/css" href="style.css">
<meta name="author" content="Andreas Schwier">
</head>
<body>
<div align="left"><a href="http://www.cardcontact.de"><img src="banner.jpg" width="750" height="80" border="0"></a></div>
<div id="navigator">
    <p><b>Smart Card<br>Shell 3</b></p>
    <a href="index.html">Home</a><br><br>
    <a href="gperror.html">GPError</a><br>
    <a href="gpsystem.html">GPSystem</a><br>
    <a href="bytestring.html">ByteString</a><br>
    <a href="bytebuffer.html">ByteBuffer</a><br>
    <a href="tlv.html">TLV</a><br>
    <a href="tlvlist.html">TLVList</a><br>
    <a href="card.html">Card</a><br>
    <a href="atr.html">Atr</a><br>
    <a href="key.html">Key</a><br>
    <a href="crypto.html">Crypto</a><br>
    <a href="application.html">Application</a><br>
    <a href="gpapplication.html">GPApplication</a><br>
    <a href="gpsecuritydomain.html">GPSecDomain</a><br>
    <br>
    <a href="asn1.html">ASN1</a><br>
    <a href="cardfile.html">CardFile</a><br>
    <a href="isosecurechannel.html">IsoSecureChannel</a><br>
    <a href="applicationfactory.html">ApplFactory</a><br>
    <a href="gpxml.html">GPXML</a><br>
    <a href="jsscript.html">JsScript</a><br>
    <a href="cardsimulationadapter.html">CardSim</a><br>
    <br>
    <a href="x509.html">X509</a><br>
    <a href="crl.html">CRL</a><br>
    <a href="keystore.html">KeyStore</a><br>
    <a href="cmssigneddata.html">CMSSignedData</a><br>
    <a href="cmsgenerator.html">CMSGenerator</a><br>
    <a href="xmlsignature.html">XMLSignature</a><br>
    <a href="ocspquery.html">OCSPQuery</a><br>
    <a href="ldap.html">LDAP</a><br>
    <a href="soapconnection.html">SOAP</a><br>
    <a href="urlconnection.html">URLConnection</a><br>
    <br>
    <a href="pkcs11provider.html">PKCS11Provider</a><br>
    <a href="pkcs11session.html">PKCS11Session</a><br>
    <a href="pkcs11object.html">PKCS11Object</a><br>
    <br>
    <a href="outlinenode.html">OutlineNode</a><br>
    <a href="dialog.html">Dialog</a><br>
    <br>
    <a href="jsdoc/index.html">Tools</a><br>
    <br>
    <a href="http://www.openscdp.org">OpenSCDP</a><br>
</div>

<div id="main">
<!-- #BeginEditable "BODY" -->
                <h1>OCSPQuery - Reference Documentation</h1>
<p>Class implementing support for the Online Certificate Status Protocol (OCSP)</p>
<h2>Index of Methods</h2>
<ul>
<li>
<a href="#Constructor">OCSPQuery() constructor</a>
</li>
<li>
<a href="#add">add()</a>
</li>
<li>
<a href="#execute">execute()</a>
</li>
<li>
<a href="#post">post()</a>
</li>
<li>
<a href="#getStatus">getStatus()</a>
</li>
<li>
<a href="#getStatusString">getStatusString()</a>
</li>
<li>
<a href="#getRevocationTime">getRevocationTime()</a>
</li>
<li>
<a href="#getRequest">getRequest()</a>
</li>
<li>
<a href="#getResponse">getResponse()</a>
</li>
</ul>
<h2>Constants</h2>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td>Number</td><td>GOOD</td><td>Certificate is valid</td>
</tr>
<tr>
<td>Number</td><td>UNKNOWN</td><td>Certificate is unknown to the responder</td>
</tr>
<tr>
<td>Number</td><td>REVOKED</td><td>Certificate was revoked</td>
</tr>
<tr>
<td>Number</td><td>KEYCOMPROMISE</td><td>Certificate was revoked because the key was compromised</td>
</tr>
<tr>
<td>Number</td><td>CACOMPROMISE</td><td>Certificate was revoked because the CA key was compromised</td>
</tr>
<tr>
<td>Number</td><td>AFFILIATIONCHANGED</td><td>Certificate was revoked because the affiliation changed</td>
</tr>
<tr>
<td>Number</td><td>SUPERSEDED</td><td>Certificate was revoked because a new certificate was issued</td>
</tr>
<tr>
<td>Number</td><td>CESSATIONOFOPERATION</td><td>Certificate was revoked because the CA discontinued operation</td>
</tr>
<tr>
<td>Number</td><td>CERTIFICATEHOLD</td><td>Certificate is on hold</td>
</tr>
<tr>
<td>Number</td><td>REMOVEFROMCRL</td><td>Certificate was revoked and can now be removed form CRL</td>
</tr>
<tr>
<td>Number</td><td>PRIVILEGEWITHDRAWN</td><td>Certificate was revoked because the privileges granted by to the owner were withdrawn</td>
</tr>
<tr>
<td>Number</td><td>AACOMPROMISE</td><td>Certificate was revoked</td>
</tr>
</table>
<h2 id="Constructor">Constructor</h2>
<h3>Prototype</h3>
<p class="signature">OCSPQuery(X509 rootCert, X509 issuerCert)</p>
<p class="signature">OCSPQuery(X509 issuerCert)</p>
<h3>Description</h3>
<p>Create OCSPQuery object that can be used to collect certificates for which the
                     the status can be queried from an OCSP responder.</p>
                     
<p>The URL for the OCSP responder is taken from isserCert.</p>
					 
<p>If the root certificate is ommited from the constructor, then the
                        signature on the OCSP response is only validated against
                        the list of certificates in the OCSPResponse. No link to a 
                        trusted anchor is verified in that case.</p>
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>X509</code></td><td>rootCert</td><td>Root certificate used for verification of OCSP response signature</td>
</tr>
<tr>
<td><code>X509</code></td><td>issuerCert</td><td>Certificate of instance that issued the certificate for which
                a query should be done.</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Arguments must be of type X509</td>
</tr>
</table>
<h3>Example</h3>
<pre>

rootcert = new X509("root.cer");
cacert = new X509("ca.cer");

query = new OCSPQuery(cacert);

query = new OCSPQuery(rootcert, cacert);

</pre>
<h2 id="add">add()</h2>
<h3>Prototype</h3>
<p class="signature">OCSPQuery add(X509 cert)</p>
<h3>Description</h3>Add a certificate to the query. The certificate must be issued by the instance
                     identified by the isserCert certificate in the OCSPQuery constructor.
                     Multiple certificates can be included in a single query.<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>X509</code></td><td>cert</td><td>Certificate to include in query</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>OCSPQuery</code></td><td>The object this method is applied to</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_DATA</td><td>Certificate is invalid for inclusion in query</td>
</tr>
</table>
<h3>Example</h3>
<pre>

goodcert = new X509("ee_good.cer");
revokedcert = new X509("ee_revoked.cer");

query.add(goodcert);
assert(query.add(revokedcert) instanceof OCSPQuery);

</pre>
<h2 id="execute">execute()</h2>
<h3>Prototype</h3>
<p class="signature">OCSPQuery execute()</p>
<h3>Description</h3>Execute query against OCSP server. This is a one in all method. It extracts the
                     URL from the issuer certificate, builds the request, posts the message, obtains
                     the response and decodes the status information.<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>OCSPQuery</code></td><td>The object this method is applied to</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>The query could not be completed successfully</td>
</tr>
</table>
<h3>Example</h3>
<pre>

assert(query.execute() instanceof OCSPQuery);

</pre>
<h2 id="post">post()</h2>
<h3>Prototype</h3>
<p class="signature">OCSPQuery post(String url, ByteString request)</p>
<p class="signature">OCSPQuery post(String url, ByteString request, String[] header)</p>
<h3>Description</h3>Send a request to the server identified by the url with a custom HTTP header. This
                     method is suitable for test setups using custom build requests and header
                     fields.<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>String</code></td><td>url</td><td>URL of OCSP responder.</td>
</tr>
<tr>
<td><code><a href="bytestring.html">ByteString</a></code></td><td>request</td><td>DER encoded request</td>
</tr>
<tr>
<td><code>String[]</code></td><td>header</td><td>Custom HTTP header field in the format "key: value". Will disable
                                                automatically generated header fields Content-Type and Content-Length.</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>ByteString</code></td><td>The response returned from the server</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>One or more arguments do not match</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>The query could not be completed successfully</td>
</tr>
</table>
<h3>Example</h3>
<pre>

var request = query.getRequest();
var response = query.post("http://ocsp.ecard.sozialversicherung.at", request);
assert(response.length &gt; 0);

var header = [ "Content-Length: " + request.length, "Content-Type: application/ocsp-request" ];
var response = query.post("http://ocsp.ecard.sozialversicherung.at", request, header);
assert(response.length &gt; 0);

</pre>
<h2 id="getStatus">getStatus()</h2>
<h3>Prototype</h3>
<p class="signature">Number getStatus(X509 cert)</p>
<h3>Description</h3>Query status from cached result of previous query operation<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>X509</code></td><td>cert</td><td>Certificate in question</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>Number</code></td><td>Status of the certificate as indicated by the responder. This is one of the
                              constant values defined for this object.</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Arguments must be of type X509</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>The query could not be completed successfully</td>
</tr>
</table>
<h3>Example</h3>
<pre>

assert(query.getStatus(goodcert) == OCSPQuery.GOOD);
assert(query.getStatus(revokedcert) != OCSPQuery.GOOD);

</pre>
<h2 id="getStatusString">getStatusString()</h2>
<h3>Prototype</h3>
<p class="signature">String getStatusString(X509 cert)</p>
<h3>Description</h3>Query status from cached result of previous query operation and return a human readable string<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>X509</code></td><td>cert</td><td>Certificate in question</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>String</code></td><td>Status of the certificate as indicated by the responder.</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Arguments must be of type X509</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>The query could not be completed successfully</td>
</tr>
</table>
<h3>Example</h3>
<pre>

print("ee_good.cer    : " + query.getStatusString(goodcert));
print("ee_revoked.cer : " + query.getStatusString(revokedcert));

</pre>
<h2 id="getRevocationTime">getRevocationTime()</h2>
<h3>Prototype</h3>
<p class="signature">Date getRevocationTime(X509 cert)</p>
<h3>Description</h3>Query revocation time from cached result of previous query operation<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>X509</code></td><td>cert</td><td>Certificate in question</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>Date</code></td><td>Revocation time of the certificate as indicated by the responder.</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Arguments must be of type X509</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>The query could not be completed successfully</td>
</tr>
</table>
<h3>Example</h3>
<pre>

var rt = query.getRevocationTime(revokedcert);
assert(rt instanceof Date);
print("ee_revoked.cer : " + rt);

</pre>
<h2 id="getRequest">getRequest()</h2>
<h3>Prototype</h3>
<p class="signature">ByteString getRequest()</p>
<h3>Description</h3>Obtain DER encoded OCSP request<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>ByteString</code></td><td>DER encoded request.</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>An error occured building the request</td>
</tr>
</table>
<h3>Example</h3>
<pre>

req = query.getRequest();
assert(req instanceof ByteString);
print(req.toString(HEX));

</pre>
<h2 id="getResponse">getResponse()</h2>
<h3>Prototype</h3>
<p class="signature">ByteString getResponse()</p>
<h3>Description</h3>Obtain DER encoded OCSP response as returned from OCSP server<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>ByteString</code></td><td>DER encoded response.</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DEVICE_ERROR</td><td>An error occured building the response</td>
</tr>
</table>
<h3>Example</h3>
<pre>

res = query.getResponse();
assert(res instanceof ByteString);
print(res.toString(HEX));

</pre>
                    <!-- #EndEditable -->
<br>
<p class="copyright">&copy; Copyright 2003 - 2010 <a href="http://www.cardcontact.de">CardContact</a>
Software & System Consulting, Minden, Germany</p>
</div>

</body>
</html><!-- #EndTemplate -->
        
