<!-- #BeginTemplate "template.dwt" -->
        <!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<!-- #BeginEditable "TITLE" -->
                <title>Card - Reference Documentation</title>
                    <!-- #EndEditable -->
<link rel=stylesheet type="text/css" href="style.css">
<meta name="author" content="Andreas Schwier">
</head>
<body>
<div align="left"><a href="http://www.cardcontact.de"><img src="banner.jpg" width="750" height="80" border="0"></a></div>
<div id="navigator">
    <p><b>Smart Card<br>Shell 3</b></p>
    <a href="index.html">Home</a><br><br>
    <a href="gperror.html">GPError</a><br>
    <a href="gpsystem.html">GPSystem</a><br>
    <a href="bytestring.html">ByteString</a><br>
    <a href="bytebuffer.html">ByteBuffer</a><br>
    <a href="tlv.html">TLV</a><br>
    <a href="tlvlist.html">TLVList</a><br>
    <a href="card.html">Card</a><br>
    <a href="atr.html">Atr</a><br>
    <a href="key.html">Key</a><br>
    <a href="crypto.html">Crypto</a><br>
    <a href="application.html">Application</a><br>
    <a href="gpapplication.html">GPApplication</a><br>
    <a href="gpsecuritydomain.html">GPSecDomain</a><br>
    <br>
    <a href="asn1.html">ASN1</a><br>
    <a href="cardfile.html">CardFile</a><br>
    <a href="isosecurechannel.html">IsoSecureChannel</a><br>
    <a href="applicationfactory.html">ApplFactory</a><br>
    <a href="gpxml.html">GPXML</a><br>
    <a href="jsscript.html">JsScript</a><br>
    <a href="cardsimulationadapter.html">CardSim</a><br>
    <br>
    <a href="x509.html">X509</a><br>
    <a href="crl.html">CRL</a><br>
    <a href="keystore.html">KeyStore</a><br>
    <a href="cmssigneddata.html">CMSSignedData</a><br>
    <a href="cmsgenerator.html">CMSGenerator</a><br>
    <a href="xmlsignature.html">XMLSignature</a><br>
    <a href="ocspquery.html">OCSPQuery</a><br>
    <a href="ldap.html">LDAP</a><br>
    <a href="soapconnection.html">SOAP</a><br>
    <a href="urlconnection.html">URLConnection</a><br>
    <br>
    <a href="pkcs11provider.html">PKCS11Provider</a><br>
    <a href="pkcs11session.html">PKCS11Session</a><br>
    <a href="pkcs11object.html">PKCS11Object</a><br>
    <br>
    <a href="outlinenode.html">OutlineNode</a><br>
    <a href="dialog.html">Dialog</a><br>
    <br>
    <a href="jsdoc/index.html">Tools</a><br>
    <br>
    <a href="http://www.openscdp.org">OpenSCDP</a><br>
</div>

<div id="main">
<!-- #BeginEditable "BODY" -->
                <h1>Card - Reference Documentation</h1>
<p>Class to allow access to ICC</p>
<h2>Index of Methods</h2>
<ul>
<li>
<a href="#Constructor">Card() constructor</a>
</li>
<li>
<a href="#reset">reset()</a>
</li>
<li>
<a href="#sendApdu">sendApdu()</a>
</li>
<li>
<a href="#plainApdu">plainApdu()</a>
</li>
<li>
<a href="#setCredential">setCredential()</a>
</li>
<li>
<a href="#sendSecMsgApdu">sendSecMsgApdu()</a>
</li>
<li>
<a href="#close">close()</a>
</li>
</ul>
<h2>Constants</h2>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td>Number</td><td>T0</td><td>T=0 protocol</td>
</tr>
<tr>
<td>Number</td><td>T1</td><td>T=1 protocol</td>
</tr>
<tr>
<td>Number</td><td>T14</td><td>T=14 protocol</td>
</tr>
<tr>
<td>Number</td><td>OTHER</td><td>Other protocol</td>
</tr>
<tr>
<td>Number</td><td>PICCA</td><td></td>
</tr>
<tr>
<td>Number</td><td>PICCB</td><td></td>
</tr>
<tr>
<td>Number</td><td>RESET_COLD</td><td>Perform cold reset</td>
</tr>
<tr>
<td>Number</td><td>RESET_WARM</td><td>Perform warm reset if supported by reader, otherwise cold reset</td>
</tr>
<tr>
<td>Number</td><td>CPRO</td><td>Usage qualifier for MAC protected command-APDU in sendSecMsgApdu()</td>
</tr>
<tr>
<td>Number</td><td>CENC</td><td>Usage qualifier for encrypted command-APDU in sendSecMsgApdu()</td>
</tr>
<tr>
<td>Number</td><td>RPRO</td><td>Usage qualifier for MAC protected response-APDU in sendSecMsgApdu()</td>
</tr>
<tr>
<td>Number</td><td>RENC</td><td>Usage qualifier for encrypted response-APDU in sendSecMsgApdu()</td>
</tr>
<tr>
<td>Number</td><td>ALL</td><td>All access modes or all usage qualifier in sendSecMsgApdu()</td>
</tr>
</table>
<h2>Properties</h2>
<table class="content">
<colgroup>
<col width="100">
<col width="120">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td>ByteString</td><td>response</td><td>Last response APDU received from ICC</td>
</tr>
<tr>
<td>Number</td><td>SW</td><td>Last status word SW1/SW2 received from ICC</td>
</tr>
<tr>
<td>Number</td><td>SW1</td><td>Last status byte SW1 received from ICC</td>
</tr>
<tr>
<td>Number</td><td>SW2</td><td>Last status byte SW2 received from ICC</td>
</tr>
<tr>
<td>String</td><td>SWMSG</td><td>Message for SW1/SW2 (Extension to GP)</td>
</tr>
</table>
<h2 id="Constructor">Constructor</h2>
<h3>Prototype</h3>
<p class="signature">Card()</p>
<p class="signature">Card(String reader)</p>
<p class="signature">Card(String reader, String cardProfileName)</p>
<h3>Description</h3>
            
<p>Create an object representing an ICC in a reader.</p>
            
<p>The name of the card terminal can be passed as argument reader. If the 
               card reader supports multiple slots, then the slot number can be specified
               by appending a hash '#' and the slot number. Slot numbers start at 1, 0 means
               any slot and is the default value (e.g. "MCT#2" selects the card reader "MCT" and the
               card in slot 2).</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>String</code></td><td>reader</td><td>Card terminal name</td>
</tr>
<tr>
<td><code>String</code></td><td>cardProfileName</td><td>Name of file containing Global Platform card profile</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_COMM_ERROR</td><td>A communication error with the ICC occured</td>
</tr>
</table>
<h3>Example</h3>
<pre>

card = new Card();
assert(card instanceof Card);

card = new Card("");
assert(card instanceof Card);

card = new Card(_scsh3.reader);
assert(card instanceof Card);

card = new Card("", "profiles/cp_jcop41.xml");
assert(card instanceof Card);

dumpxml(card.profile, "");

</pre>
<h2 id="reset">reset()</h2>
<h3>Prototype</h3>
<p class="signature">Atr reset(Number resetMode)</p>
<h3>Description</h3>
			Perform a cold or warm reset with the ICC.
        <h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>Number</code></td><td>resetMode</td><td>Reset mode, either Card.RESET_COLD or Card.RESET_WARM.</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>Atr</code></td><td>ATR returned by ICC</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Argument must be of type Number and either Card.RESET_COLD or Card.RESET_WARM</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_COMM_ERROR</td><td>A communication error with the ICC occured</td>
</tr>
</table>
<h3>Example</h3>
<pre>

card = new Card();
atr = card.reset(Card.RESET_COLD);
print("Format Byte     : " + atr.formatByte.toString(16));
print("Interface Bytes : " + atr.interfaceBytes);
print("Historical Bytes: " + atr.historicalBytes);
print("Check Bytes     : " + atr.tckByte.toString(16));
print(atr);

</pre>
<h2 id="sendApdu">sendApdu()</h2>
<h3>Prototype</h3>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, Number[] sw)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, ByteString data)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, ByteString data, Number[] sw)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, Number le)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, Number le, Number[] sw)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, ByteString data, Number le)</p>
<p class="signature">ByteString sendApdu (Number cla, Number ins, Number p1, Number p2, ByteString data, Number le, Number[] sw)</p>
<h3>Description</h3>
<p>Transmit a Command-APDU to the ICC and receive the Response-APDU.</p>
                     
<p>The method updates the fields SW, SW1, SW2 and response with the values received from the ICC.</p>
                     
<p>An array of valid return codes can be passed as argument sw. If the SW1/SW2 from the ICC does
                        not match with one of the entries in the array, then an GPError.CARD_COMM_ERROR exception is raised.</p>
                     
<p>The method supports ISO7816-4 extended format. This is automatically used, if the length of the data
                        argument exceeds 255 or if the argument le exceeds 256.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>Number</code></td><td>cla</td><td>The CLA byte for the Command-APDU</td>
</tr>
<tr>
<td><code>Number</code></td><td>ins</td><td>The INS byte for the Command-APDU</td>
</tr>
<tr>
<td><code>Number</code></td><td>p1</td><td>The P1 byte for the Command-APDU</td>
</tr>
<tr>
<td><code>Number</code></td><td>p2</td><td>The P2 byte for the Command-APDU</td>
</tr>
<tr>
<td><code><a href="bytestring.html">ByteString</a></code></td><td>data</td><td>The data bytes to be send in the Command-APDU for case 3 or case 4 commands</td>
</tr>
<tr>
<td><code>Number</code></td><td>le</td><td>The number of bytes expected in the response. 256 is encoded as '00' in short format.
                                          65536 is encoded as '0000' in extended format.</td>
</tr>
<tr>
<td><code>Number[]</code></td><td>sw</td><td>Array of acceptable SW1/SW2 return codes</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>ByteString</code></td><td>Response APDU received from ICC</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for call or SW array contain a type other than Number</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_COMM_ERROR</td><td>A communication error with the ICC occured</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_INVALID_SW</td><td>The status word return by the ICC does not match one of the expected result</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DATA_TOO_LARGE</td><td>The data for the command APDU exceeds 65536</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_LENGTH</td><td>The value given for Le is out of range</td>
</tr>
</table>
<h3>Example</h3>
<pre>

// Case 1: 0022F3A4 - MANAGE SE

resp = card.sendApdu(0x00, 0x22, 0xF3, 0xA4);
print(card.SW.toString(16) + " - " + resp);

// Must return ByteString, null or undefined ?
assert(card.SW == 0x9000);
assert(card.SW1 == 0x90);
assert(card.SW2 == 0x00);

resp = card.sendApdu(0x00, 0x22, 0xF3, 0xA4, [0x9000]);
// Must return ByteString, null or undefined ?


// Case 2: 00B201F400 - READ RECORD from EF_DIR

resp = card.sendApdu(0x00, 0xB2, 0x01, 0xF4, 0);
print(card.SW.toString(16) + " - " + resp);

assert(resp.length &gt; 0);
assert(card.SW == 0x9000);
assert(card.response.equals(resp));

resp = card.sendApdu(0x00, 0xB2, 0x01, 0xF4, 0, [0x9000]);
assert(resp.length &gt; 0);


// Case 3: 002A90A008 - HASH

resp = card.sendApdu(0x00, 0x2A, 0x90, 0xA0, new ByteString("9000800431323334", HEX));
print(card.SW.toString(16) + " - " + resp);

assert(card.SW == 0x9000);

resp = card.sendApdu(0x00, 0x2A, 0x90, 0xA0, 
                            new ByteString("9000800431323334", HEX),[0x9000]);


// Case 4: 00A40204022F0000 - SELECT EF_DIR

resp = card.sendApdu(0x00, 0xA4, 0x02, 0x04, new ByteString("2F00", HEX), 0);
print(card.SW.toString(16) + " - " + resp);

assert(card.SW == 0x9000);
assert(resp.length &gt; 0);

resp = card.sendApdu(0x00, 0xA4, 0x02, 0x04, new ByteString("2F00", HEX), 0, [0x9000]);
assert(resp.length &gt; 0);

</pre>
<h2 id="plainApdu">plainApdu()</h2>
<h3>Prototype</h3>
<p class="signature">ByteString sendApdu (ByteString apdu)</p>
<p class="signature">ByteString sendApdu (ByteString apdu, Number[] sw)</p>
<p class="signature">ByteString sendApdu (ByteString apdu, Number[] sw, Number usageQualifier)</p>
<h3>Description</h3>
<p>Transmit a Command-APDU to the ICC and receive the Response-APDU.</p>
                     
<p>The method updates the fields SW, SW1, SW2 and response with the values received from the ICC.</p>
                     
<p>An array of valid return codes can be passed as argument sw. If the SW1/SW2 from the ICC does
                        not match with one of the entries in the array, then an GPError.CARD_COMM_ERROR exception is raised.</p>
                     
<p>This method is an extension to the Global Platform Scripting specification.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code><a href="bytestring.html">ByteString</a></code></td><td>apdu</td><td>Command-APDU in plain format consisting of CLA|INS|P1|P2|Lc|Data|Le</td>
</tr>
<tr>
<td><code>Number[]</code></td><td>sw</td><td>Array of acceptable SW1/SW2 return codes</td>
</tr>
<tr>
<td><code>Number</code></td><td>usageQualifier</td><td>Usage qualifier to be passed to secure messaging transformation</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>ByteString</code></td><td>Response APDU received from ICC</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for call or SW array contain a type other than Number</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_COMM_ERROR</td><td>A communication error with the ICC occured</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_SW</td><td>The status word return by the ICC does not match one of the expected result</td>
</tr>
</table>
<h3>Example</h3>
<pre>

// Case 1: 0022F3A4 - MANAGE SE

resp = card.plainApdu(new ByteString("0022F3A4", HEX));
print(card.SW.toString(16) + " - " + resp);

// Must return ByteString, null or undefined ?
assert(card.SW == 0x9000);
assert(card.SW1 == 0x90);
assert(card.SW2 == 0x00);

resp = card.plainApdu(new ByteString("0022F3A4", HEX), [0x9000]);
// Must return ByteString, null or undefined ?


// Case 2: 00B201F400 - READ RECORD from EF_DIR

resp = card.plainApdu(new ByteString("00B201F400", HEX));
print(card.SW.toString(16) + " - " + resp);

assert(resp.length &gt; 0);
assert(card.SW == 0x9000);
assert(card.response.equals(resp));

resp = card.plainApdu(new ByteString("00B201F400", HEX), [0x9000]);
assert(resp.length &gt; 0);


// Case 3: 002A90A008 - HASH

resp = card.plainApdu(new ByteString("002A90A0089000800431323334", HEX));
print(card.SW.toString(16) + " - " + resp);

assert(card.SW == 0x9000);

resp = card.plainApdu(new ByteString("002A90A0089000800431323334", HEX), [0x9000]);


// Case 4: 00A40204022F0000 - SELECT EF_DIR

resp = card.plainApdu(new ByteString("00A40204022F0000", HEX));
print(card.SW.toString(16) + " - " + resp);

assert(card.SW == 0x9000);
assert(resp.length &gt; 0);

resp = card.plainApdu(new ByteString("00A40204022F0000", HEX), [0x9000]);
assert(resp.length &gt; 0);

</pre>
<h2 id="setCredential">setCredential()</h2>
<h3>Prototype</h3>
<p class="signature">setCredential(Object credential)</p>
<h3>Description</h3>
            
<p>Provide an object that contains the credential required to transform the APDU when
               using sendSecMsgApdu().</p>
            
<p>Currently only a secure channel credential can be supplied. A secure channel credential
               is a JavaScript object that supplies a wrap() and optionally an unwrap() method. The
               wrap() method is called to transform the command-APDU, the unwrap() method is called to
               transform the response-APDU.</p>
	
<p>The usage qualifier in the sendSecMsgApdu() determins, which part of the command and response APDU are to be
               protected and how. Any of the following four options can be combined: MAC protected command APDU (CPRO), encrypted 
               command APDU (CENC), MAC protected response APDU (RPRO) and encrypted response APDU (RENC).</p>
            
<p>The usage qualifier controls the transformation of command and reponse APDU. It is passed
               to the wrap() and unwrap() method as the second parameter.</p>
            
<p>The usage qualifier can be defined by or'ing the constants Card.CPRO, Card.CENC, Card.RPRO or
               Card.RENC. Use Card.ALL as a combination of the above.</p>
            
<p>Subsequent calls to this method will overwrite the previous credential.</p>
            
<p>This method is an extension to the Global Platform Scripting specification.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>Object</code></td><td>credential</td><td>Object to be used as credential.</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code></code></td><td>Method does not return a value</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_COMM_ERROR</td><td>An error occured while talking to the ICC</td>
</tr>
</table>
<h3>Example</h3>
<pre>


//
// Define SecureChannelCredential class constructor
//
function SecureChannelCredential() {
}

//
// Wrap command-APDU with secure messaging
//
SecureChannelCredential.prototype.wrap = function(apduToWrap, usageQualifier) {
	print("APDU to wrap with usageQualifier " + usageQualifier + " :");
	print(apduToWrap);
	
	// Put secure messaging transformation here
	
	return(apduToWrap);
}


//
// Unwrap response-APDU with secure messaging
//
SecureChannelCredential.prototype.unwrap = function(apduToUnwrap, usageQualifier) {
	print("APDU to unwrap with usageQualifier " + usageQualifier + " :");
	print(apduToUnwrap);
	
	// Put secure messaging transformation here
	
	return(apduToUnwrap);
}

card.reset(Card.RESET_COLD);

// Allocate a secure channel credential
var sc = new SecureChannelCredential();

card.setCredential(sc);

// Allocate a cardfile object

var response = card.sendSecMsgApdu(Card.ALL, 0x00, 0xA4, 0x02, 0x04,
                            new ByteString("2F00", HEX), 0, [0x9000]);
print(response);


</pre>
<h2 id="sendSecMsgApdu">sendSecMsgApdu()</h2>
<h3>Prototype</h3>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, Number[] sw)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, ByteString data)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, ByteString data, Number[] sw)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, Number le)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, Number le, Number[] sw)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, ByteString data, Number le)</p>
<p class="signature">ByteString sendSecMsgApdu(Number usageQualifier, Number cla, Number ins, Number p1, Number p2, ByteString data, Number le, Number[] sw)</p>
<h3>Description</h3>
<p>Transmit a Command-APDU to the ICC and receive the Response-APDU.</p>
                     
<p>If a secure channel is set with the setCredential() method, then this credential
                        will be used to tranform the command and response APDU accordingly. During this
                        transformation process, the usageQualifier is passed to the wrapping / unwrapping
                        methods.</p>
                     
<p>The method updates the fields SW, SW1, SW2 and response with the values received from the ICC.</p>
                     
<p>An array of valid return codes can be passed as argument sw. If the SW1/SW2 from the ICC does
                        not match with one of the entries in the array, then an GPError.CARD_COMM_ERROR exception is raised.</p>
                     
<p>The method supports ISO7816-4 extended format. This is automatically used, if the length of the data
                        argument exceeds 255 or if the argument le exceeds 256.</p>
                     
<p>This method is an extension to the Global Platform Scripting specification.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>Number</code></td><td>usageQualifier</td><td>Usage qualifier for secure messaging transformation. Can be a combination of
                Card.CPRO, Card.CENC, Card.RPRO, Card.RENC and Card.ALL.</td>
</tr>
<tr>
<td><code>Number</code></td><td>cla</td><td>The CLA byte for the Command-APDU</td>
</tr>
<tr>
<td><code>Number</code></td><td>ins</td><td>The INS byte for the Command-APDU</td>
</tr>
<tr>
<td><code>Number</code></td><td>p1</td><td>The P1 byte for the Command-APDU</td>
</tr>
<tr>
<td><code>Number</code></td><td>p2</td><td>The P2 byte for the Command-APDU</td>
</tr>
<tr>
<td><code><a href="bytestring.html">ByteString</a></code></td><td>data</td><td>The data bytes to be send in the Command-APDU for case 3 or case 4 commands</td>
</tr>
<tr>
<td><code>Number</code></td><td>le</td><td>The number of bytes expected in the response. 256 is encoded as '00' in short format.
                                          65536 is encoded as '0000' in extended format.</td>
</tr>
<tr>
<td><code>Number[]</code></td><td>sw</td><td>Array of acceptable SW1/SW2 return codes</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>ByteString</code></td><td>Response APDU received from ICC</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for call or SW array contain a type other than Number</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_COMM_ERROR</td><td>A communication error with the ICC occured</td>
</tr>
<tr>
<td>GPError</td><td>GPError.CARD_INVALID_SW</td><td>The status word return by the ICC does not match one of the expected result</td>
</tr>
<tr>
<td>GPError</td><td>GPError.DATA_TOO_LARGE</td><td>The data for the command APDU exceeds 65536</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_LENGTH</td><td>The value given for Le is out of range</td>
</tr>
</table>
<h3>Example</h3>
<pre>

// See sendApdu() and setCredential() for an example

</pre>
<h2 id="close">close()</h2>
<h3>Prototype</h3>
<p class="signature">close()</p>
<h3>Description</h3>
	
<p>Release card object, closing communication channel with the card</p>
	
<p>If close() is not explicitly called for a card object, then the smart card
	   communication channel will be closed during garbage collection at latest</p>
	
<p>The method is usefull to ensure, that other applications can get access
	   to the card.</p>
        
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code></code></td><td></td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
</table>
<h3>Example</h3>
<pre>

card.close();

</pre>
                    <!-- #EndEditable -->
<br>
<p class="copyright">&copy; Copyright 2003 - 2010 <a href="http://www.cardcontact.de">CardContact</a>
Software & System Consulting, Minden, Germany</p>
</div>

</body>
</html><!-- #EndTemplate -->
        
