<!-- #BeginTemplate "template.dwt" -->
        <!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<!-- #BeginEditable "TITLE" -->
                <title>ApplicationFactory - Reference Documentation</title>
                    <!-- #EndEditable -->
<link rel=stylesheet type="text/css" href="style.css">
<meta name="author" content="Andreas Schwier">
</head>
<body>
<div align="left"><a href="http://www.cardcontact.de"><img src="banner.jpg" width="750" height="80" border="0"></a></div>
<div id="navigator">
    <p><b>Smart Card<br>Shell 3</b></p>
    <a href="index.html">Home</a><br><br>
    <a href="gperror.html">GPError</a><br>
    <a href="gpsystem.html">GPSystem</a><br>
    <a href="bytestring.html">ByteString</a><br>
    <a href="bytebuffer.html">ByteBuffer</a><br>
    <a href="tlv.html">TLV</a><br>
    <a href="tlvlist.html">TLVList</a><br>
    <a href="card.html">Card</a><br>
    <a href="atr.html">Atr</a><br>
    <a href="key.html">Key</a><br>
    <a href="crypto.html">Crypto</a><br>
    <a href="application.html">Application</a><br>
    <a href="gpapplication.html">GPApplication</a><br>
    <a href="gpsecuritydomain.html">GPSecDomain</a><br>
    <br>
    <a href="asn1.html">ASN1</a><br>
    <a href="cardfile.html">CardFile</a><br>
    <a href="isosecurechannel.html">IsoSecureChannel</a><br>
    <a href="applicationfactory.html">ApplFactory</a><br>
    <a href="gpxml.html">GPXML</a><br>
    <a href="jsscript.html">JsScript</a><br>
    <a href="cardsimulationadapter.html">CardSim</a><br>
    <br>
    <a href="x509.html">X509</a><br>
    <a href="crl.html">CRL</a><br>
    <a href="keystore.html">KeyStore</a><br>
    <a href="cmssigneddata.html">CMSSignedData</a><br>
    <a href="cmsgenerator.html">CMSGenerator</a><br>
    <a href="xmlsignature.html">XMLSignature</a><br>
    <a href="ocspquery.html">OCSPQuery</a><br>
    <a href="ldap.html">LDAP</a><br>
    <a href="soapconnection.html">SOAP</a><br>
    <a href="urlconnection.html">URLConnection</a><br>
    <br>
    <a href="pkcs11provider.html">PKCS11Provider</a><br>
    <a href="pkcs11session.html">PKCS11Session</a><br>
    <a href="pkcs11object.html">PKCS11Object</a><br>
    <br>
    <a href="outlinenode.html">OutlineNode</a><br>
    <a href="dialog.html">Dialog</a><br>
    <br>
    <a href="jsdoc/index.html">Tools</a><br>
    <br>
    <a href="http://www.openscdp.org">OpenSCDP</a><br>
</div>

<div id="main">
<!-- #BeginEditable "BODY" -->
                <h1>ApplicationFactory - Reference Documentation</h1>
<p>
        
<p>Repository for application and key profiles, as well as factory to create 
           instances of Application, GPApplication or GPSecurityDomain objects,
           which resemble the execution environment for Global Platform Scripts.
        </p>
    
</p>
<h2>Index of Methods</h2>
<ul>
<li>
<a href="#Constructor">ApplicationFactory() constructor</a>
</li>
<li>
<a href="#addKeyProfile">addKeyProfile()</a>
</li>
<li>
<a href="#addApplicationProfile">addApplicationProfile()</a>
</li>
<li>
<a href="#getApplicationInstance">getApplicationInstance()</a>
</li>
</ul>
<h2 id="Constructor">Constructor</h2>
<h3>Prototype</h3>
<p class="signature">ApplicationFactory(Crypto crypto)</p>
<h3>Description</h3>
            
<p>Create an instance of the ApplicationFactory.</p>
                            
<p>The application factory is used as a repository of application and
               key profiles. It can create instances of the Application, GPApplication and
               GPSecurityDomain objects using the getApplicationInstance() method.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>Crypto</code></td><td>crypto</td><td>Crypto object to be associated with applications</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments given</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>On or more arguments are not of the expected type</td>
</tr>
</table>
<h3>Example</h3>
<pre>

var crypto = new Crypto();

var af = new ApplicationFactory(crypto);
assert(af != null);

</pre>
<h2 id="addKeyProfile">addKeyProfile()</h2>
<h3>Prototype</h3>
<p class="signature">Void addKeyProfile(String profileName)</p>
<h3>Description</h3>
                            
<p>Deserialize the key profile stored in the file specified by profileName and store
               it under the UniqueId in an internal repository.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>String</code></td><td>profileName</td><td>Name of key profile. Will be mapped to a physical file by the runtime environment.</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>Void</code></td><td>The method does not return a value</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for method invocation</td>
</tr>
</table>
<h3>Example</h3>
<pre>

af.addKeyProfile("profiles/kp_single_des_1.xml");
af.addKeyProfile("profiles/kp_double_des.xml");
af.addKeyProfile("profiles/kp_triple_des.xml");

</pre>
<h2 id="addApplicationProfile">addApplicationProfile()</h2>
<h3>Prototype</h3>
<p class="signature">Void addApplicationProfile(String profileName)</p>
<h3>Description</h3>
                            
<p>Deserialize the application profile stored in the file specified by profileName and store
               it under the UniqueId in an internal repository.</p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>String</code></td><td>profileName</td><td>Name of application profile. Will be mapped to a physical file by the runtime environment.</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>Void</code></td><td>The method does not return a value</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for method invocation</td>
</tr>
</table>
<h3>Example</h3>
<pre>

af.addApplicationProfile("profiles/ap_test.xml");

</pre>
<h2 id="getApplicationInstance">getApplicationInstance()</h2>
<h3>Prototype</h3>
<p class="signature">Application getApplicationInstance(Object dataMapper, ByteString aid, ByteString uniqueId)</p>
<p class="signature">Application getApplicationInstance(Object dataMapper, ByteString aid, Card card)</p>
<p class="signature">Application getApplicationInstance(Object dataMapper, ByteString aid, Card card, ByteString uniqueId)</p>
<h3>Description</h3>
                      
<p>Create and initialize an Application, GPApplication or GPSecurityDomain object based on the
             the definition in the XML profile.</p>
                      
<p>The dataMapper object is used to read and write data element from an external source.
             The object must provide a get(name, fixed, length) function that returns a ByteString
             object. The arguments name, fixed and length are initialized from the respective fields
             in the application profile. The dataMapper will be associated with the application instance.</p>
                      
<p>The aid is used to initialize the aid property of the Application objects. It is
             furthermore used to locate an application instance if a card object is provided as
             argument.</p>
                      
<p>The optional card argument can be used to define the card property of the Application
             object. If a card object is defined, then the list of application instances in the
             card profile can be used to locate the appropriate application profile in the application
             factory.</p>
                      
<p>The optional uniqueId can be used to identify an application profile previously
             registered in the application factory. If the uniqueId is not given as argument, then
             it is determined from the list of application instances in the card profile.</p>
                      
<p>Use the run() method to execute scripts defined in the application profile.</p>
                      
<p></p>
        
<h3>Arguments</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="100">
<col>
</colgroup>
<tr>
<th>Type</th><th>Name</th><th>Description</th>
</tr>
<tr>
<td><code>Object</code></td><td>dataMapper</td><td>Object to provide mapping of data element from an external
                     source to data element accessible from within scripts</td>
</tr>
<tr>
<td><code><a href="bytestring.html">ByteString</a></code></td><td>aid</td><td>Application identifier for instance</td>
</tr>
<tr>
<td><code>Card</code></td><td>card</td><td>Card object to be used for instance or null</td>
</tr>
<tr>
<td><code><a href="bytestring.html">ByteString</a></code></td><td>uniqueId</td><td>UniqueID of application profile to be used</td>
</tr>
</table>
<h3>Return</h3>
<table>
<colgroup>
<col width="100">
<col>
</colgroup>
<tr>
<td><code>Application</code></td><td>The method returns an Application object</td>
</tr>
</table>
<h3>Exceptions</h3>
<table class="content">
<colgroup>
<col width="100">
<col width="200">
<col>
</colgroup>
<tr>
<th>Name</th><th>Value</th><th>Description</th>
</tr>
<tr>
<td>GPError</td><td>GPError.ARGUMENTS_MISSING</td><td>Too few arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_ARGUMENTS</td><td>Too many arguments in call</td>
</tr>
<tr>
<td>GPError</td><td>GPError.INVALID_TYPE</td><td>Type of argument is invalid for method invocation</td>
</tr>
</table>
<h3>Example</h3>
<pre>

var card = new Card(_scsh3.reader);
var aid = new ByteString("A0000002471001", HEX);
var id = new ByteString("2B0601040181C31F0000", HEX);

// Simple data mapper that returns the name of the data element as value
var dataMapper = new Object();
dataMapper.get = function(name, fixed, length, encoding) { 
    return new ByteString("DE " + name + " Fixed=" + fixed + " Length=" + length + 
    " Encoding=" + encoding, ASCII); };
dataMapper.put = function(name, value, encoding) { 
    print("DE " + name + " Value=" + value.toString(encoding) + 
    " Encoding=" + encoding); };

var appl = af.getApplicationInstance(dataMapper, aid, card, id);

appl.run("Hello World Test");

</pre>
                    <!-- #EndEditable -->
<br>
<p class="copyright">&copy; Copyright 2003 - 2010 <a href="http://www.cardcontact.de">CardContact</a>
Software & System Consulting, Minden, Germany</p>
</div>

</body>
</html><!-- #EndTemplate -->
        
